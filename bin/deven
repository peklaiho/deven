#!/usr/bin/env php
<?php
require(__DIR__ . '/../vendor/autoload.php');

// If no arguments, show help and exit
if ($argc < 2) {
    echo 'Available commands:' . PHP_EOL;
    echo 'create' . PHP_EOL;
    echo 'destroy' . PHP_EOL;
    echo 'status' . PHP_EOL;
    exit(1);
}

$configFinder = new PekLaiho\Deven\ConfigFinder();
$configFile = $configFinder->find();

if (!$configFile) {
    fwrite(STDERR, "Unable to find deven.yml file");
    exit(1);
}

$configReader = new PekLaiho\Deven\ConfigReader();
$config = $configReader->read($configFile);

$runner = new PekLaiho\Deven\ShellRunner();
$result = $runner->run(['sleep', '1']);

$hypervisor = new PekLaiho\Deven\VirtualBox();

$command = $argv[1];
$args = array_slice($argv, 2);

if (str_starts_with('create', $command)) {
    $cmd = new PekLaiho\Deven\Cmd\Create();
} elseif (str_starts_with('destroy', $command)) {
    $cmd = new PekLaiho\Deven\Cmd\Destroy();
} elseif (str_starts_with('status', $command)) {
    $cmd = new PekLaiho\Deven\Cmd\Status();
} else {
    fwrite(STDERR, "Unknown command: $command" . PHP_EOL);
    exit(1);
}

$cmd->execute($hypervisor, $config, $args);
